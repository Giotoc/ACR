<?xml version="1.0" encoding="UTF-8"?>
<view xmlns="http://asyncode.com/View"
	xmlns:db="http://asyncode.com/DataBase">
	<param name="offset" default="0" type="number"/>
	<param name="limit" default="10" type="number"/>
	<!--<condition/>-->
	<!--<output format="xml"/>-->
	<set name="quantity">
		select count(id) from optimizeyourcode.articles where draft is not true
	</set>
	<define name="drafts" command="db:query" condition="session.loggedIn">
		select id,title,lang,date_trunc('minute',create_date) as create_date from  optimizeyourcode.articles where draft is true order by create_date DESC
	</define>
	<define name="articles" command="db:query">
		select id,title,lang,date_trunc('minute',create_date) as create_date,abstract from optimizeyourcode.articles where draft is not true order by create_date DESC offset {$offset} limit {$limit}
	</define>
	<define name="articlesPars">
		<![CDATA[<offset>{$offset}</offset>
		<limit>{$limit}</limit>
		<quantity>{$quantity}</quantity>]]>
	</define>

	<add name="layout">
	<pageTitle langElement="articles"/>
	<block type="container" name="body">
		<widget name="drafts" type="list" dataSource="drafts" schema="article">
			<before><h2><ml name="drafts"/></h2></before>
			<template>
				<a href="" class="block">
					<pars for="href">/article/<node name="id"/>/<node name="title"/></pars>
					<h2><node name="title"/></h2>
				</a>
			</template>
		</widget>
		<widget name="articles" type="list" dataSource="articles" titleID="articles" schema="article">
			<before><h2><ml name="articles"/></h2></before>
			<template>
				<a href="" class="block">
					<pars for="href">/article/<node name="id"/>/<node name="title"/></pars>
					<h2><node name="title"/></h2>
					<div class="lang">
						language:
						<img src="" alt="">
							<pars for="src">http://e.fstatic.eu/flags/<node name="lang"/>.png</pars>
							<pars for="alt"><node name="lang"/></pars>
						</img>
					</div>
					<div class="date">
						<node name="create_date"/>
					</div>
					<div class="abstract"><node name="abstract"/></div>
				</a>
			</template>
		</widget>
		<widget name="paginate" type="paginate" parsSource="articlesPars"/>
	</block>
	</add>
</view>
